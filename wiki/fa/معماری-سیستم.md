
# معماری سیستم RssBot

پلتفرم RssBot بر اساس یک معماری میکروسرویس ترکیبی (Hybrid Microservices) طراحی شده است که هدف آن ارائه حداکثر انعطاف‌پذیری، پایداری و توسعه‌پذیری است.

## اجزای اصلی

معماری RssBot از دو بخش اصلی تشکیل شده است:

1.  **هسته پلتفرم (Core Platform):** مغز متفکر سیستم که در مسیر `src/rssbot/` قرار دارد.
2.  **سرویس‌ها (Services):** واحدهای مستقل عملکردی که هر کدام مسئولیت خاصی را بر عهده دارند و در پوشه `services/` قرار گرفته‌اند.

---

### ۱. هسته پلتفرم

هسته پلتفرم شامل اجزای حیاتی زیر است که مدیریت و هماهنگی کل سیستم را بر عهده دارند:

#### **کنترلر مرکزی (Core Controller)**

-   **مسیر:** `src/rssbot/core/controller.py`
-   **وظیفه:** این کنترلر قلب تپنده پلتفرم است. وظیفه اصلی آن کشف سرویس‌ها (Service Discovery)، مدیریت چرخه حیات آن‌ها و تصمیم‌گیری در مورد نحوه مسیریابی درخواست‌ها است.
-   **عملکرد:** هنگام راه‌اندازی، کنترلر تمام سرویس‌های موجود را شناسایی کرده و بر اساس پیکربندی هر سرویس، تصمیم می‌گیرد که آیا آن را به صورت یک **روتر داخلی (In-Process Router)** بارگذاری کند یا از طریق **REST API** با آن ارتباط برقرار کند.

#### **رجیستری کش‌شده (Cached Registry)**

-   **مسیر:** `src/rssbot/discovery/cached_registry.py`
-   **وظیفه:** این بخش اطلاعات مربوط به سرویس‌های فعال، وضعیت سلامت (Health Status) و روش ارتباطی (Connection Method) آن‌ها را در Redis کش می‌کند.
-   **مزیت:** با استفاده از Redis، کشف سرویس‌ها در کمتر از یک میلی‌ثانیه انجام می‌شود که سرعت ارتباط بین سرویس‌ها را به شدت افزایش می‌دهد.

#### **پراکسی سرویس (ServiceProxy)**

-   **مسیر:** `src/rssbot/discovery/proxy.py`
-   **وظیفه:** این کلاس یک ابزار هوشمند برای برقراری ارتباط بین سرویس‌هاست. توسعه‌دهندگان بدون نگرانی از نحوه پیاده‌سازی سرویس مقصد، می‌توانند به سادگی متدهای آن را فراخوانی کنند.
-   **عملکرد:** `ServiceProxy` به طور خودکار از رجیستری کش‌شده استعلام می‌گیرد و بهترین روش ارتباطی را انتخاب می‌کند:
    -   **Router Mode:** اگر سرویس مقصد به صورت روتر داخلی بارگذاری شده باشد، متد آن به صورت مستقیم و بدون سربار شبکه فراخوانی می‌شود.
    -   **REST Mode:** اگر سرویس به صورت مستقل در حال اجرا باشد، `ServiceProxy` یک درخواست HTTP به اندپوینت مربوطه ارسال می‌کند.
    -   **Hybrid Mode:** ترکیبی از دو حالت بالا که انعطاف‌پذیری را به حداکثر می‌رساند.

---

### ۲. سرویس‌ها

هر سرویس یک برنامه FastAPI مستقل است که یک قابلیت خاص را ارائه می‌دهد. این استقلال به تیم‌ها اجازه می‌دهد تا بدون تأثیر بر سایر بخش‌های سیستم، سرویس خود را توسعه داده و منتشر کنند.

**مثال‌هایی از سرویس‌ها:**

-   **`channel_mgr_svc`:** مدیریت کانال‌ها و فیدهای RSS.
-   **`ai_svc`:** ارائه قابلیت‌های هوش مصنوعی مانند خلاصه‌سازی محتوا.
-   **`bot_svc`:** ارتباط با API تلگرام و ارسال پیام‌ها.
-   **`user_svc`:** مدیریت کاربران و اشتراک‌ها.

این معماری ماژولار و انعطاف‌پذیر، RssBot را به یک پلتفرم قدرتمند و آماده برای توسعه‌های آینده تبدیل کرده است.
